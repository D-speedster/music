@echo off
chcp 65001 >nul
title Telegram Music Bot - ุงุฌุฑุง ุฑุจุงุช

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ                    ๐ต Telegram Music Bot ๐ต                 โ
echo โ                      ุงุฌุฑุง ุฑุจุงุช ููุฒฺฉ                       โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

:: ุจุฑุฑุณ ูุฌูุฏ ูุญุท ูุฌุงุฒ
if not exist "venv\" (
    echo โ ูุญุท ูุฌุงุฒ ุงูุช ูุดุฏ!
    echo ๐ก ูุทูุงู ุงุจุชุฏุง install.bat ุฑุง ุงุฌุฑุง ฺฉูุฏ.
    echo.
    pause
    exit /b 1
)

:: ุจุฑุฑุณ ูุฌูุฏ ูุงู .env
if not exist ".env" (
    echo โ ูุงู .env ุงูุช ูุดุฏ!
    echo ๐ก ูุทูุงู ุงุจุชุฏุง ูุงู .env ุฑุง ุชูุธู ฺฉูุฏ.
    echo.
    echo ๐ ูุฑุงุญู ุชูุธู:
    echo    1. ูุงู .env.example ุฑุง ฺฉูพ ฺฉุฑุฏู ู ูุงู ุขู ุฑุง ุจู .env ุชุบุฑ ุฏูุฏ
    echo    2. BOT_TOKEN ู ADMIN_USER_ID ุฑุง ุชูุธู ฺฉูุฏ
    echo.
    pause
    exit /b 1
)

:: ูุนุงูโุณุงุฒ ูุญุท ูุฌุงุฒ
echo ๐ ูุนุงูโุณุงุฒ ูุญุท ูุฌุงุฒ...
call venv\Scripts\activate.bat

:: ุจุฑุฑุณ ูุตุจ ูุงุจุณุชฺฏโูุง
echo ๐ ุจุฑุฑุณ ูุงุจุณุชฺฏโูุง...
python -c "import telegram, mutagen, aiofiles, aiosqlite" 2>nul
if errorlevel 1 (
    echo โ ุจุฑุฎ ูุงุจุณุชฺฏโูุง ูุตุจ ูุดุฏูโุงูุฏ!
    echo ๐ ูุตุจ ูุงุจุณุชฺฏโูุง...
    pip install -r requirements.txt
    if errorlevel 1 (
        echo โ ุฎุทุง ุฏุฑ ูุตุจ ูุงุจุณุชฺฏโูุง!
        pause
        exit /b 1
    )
)

:: ุจุฑุฑุณ ูุฌูุฏ ุฏุงุฑฺฉุชูุฑโูุง ููุฑุฏ ูุงุฒ
if not exist "temp\" mkdir temp
if not exist "output\" mkdir output

:: ุงุฌุฑุง ุฑุจุงุช
echo.
echo โ ููู ฺุฒ ุขูุงุฏู ุงุณุช!
echo ๐ ุดุฑูุน ุฑุจุงุช...
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ  ุจุฑุง ุชููู ุฑุจุงุช ุงุฒ Ctrl+C ุงุณุชูุงุฏู ฺฉูุฏ                    โ
echo โ  ูุงฺฏโูุง ุฏุฑ ูพุงู ููุงุด ุฏุงุฏู ูโุดููุฏ                        โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

:: ุงุฌุฑุง ุฑุจุงุช ุจุง ูุฏุฑุช ุฎุทุง
python bot.py
set exit_code=%errorlevel%

echo.
if %exit_code% equ 0 (
    echo โ ุฑุจุงุช ุจุง ููููุช ูุชููู ุดุฏ.
) else (
    echo โ ุฑุจุงุช ุจุง ุฎุทุง ูุชููู ุดุฏ! (ฺฉุฏ ุฎุทุง: %exit_code%)
    echo.
    echo ๐ ุฑุงูููุง ุนุจโุงุจ:
    echo    1. ุจุฑุฑุณ ุงุชุตุงู ุงูุชุฑูุช
    echo    2. ุจุฑุฑุณ ุตุญุช BOT_TOKEN ุฏุฑ ูุงู .env
    echo    3. ุจุฑุฑุณ ูุงฺฏโูุง ุจุงูุง ุจุฑุง ุฌุฒุฆุงุช ุฎุทุง
    echo    4. ุงุทููุงู ุงุฒ ูุตุจ FFmpeg
    echo.
)

echo.
echo ๐ ุจุฑุง ุงุฌุฑุง ูุฌุฏุฏุ ุงู ูุงู ุฑุง ุฏูุจุงุฑู ุงุฌุฑุง ฺฉูุฏ.
pause